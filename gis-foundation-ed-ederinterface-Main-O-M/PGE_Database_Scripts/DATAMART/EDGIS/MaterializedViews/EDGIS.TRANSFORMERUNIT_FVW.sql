Prompt drop Materialized View TRANSFORMERUNIT_FVW;
DROP MATERIALIZED VIEW EDGIS.TRANSFORMERUNIT_FVW
/
Prompt Materialized View TRANSFORMERUNIT_FVW;
--
-- TRANSFORMERUNIT_FVW  (Materialized View) 
--
CREATE MATERIALIZED VIEW EDGIS.TRANSFORMERUNIT_FVW (ANCILLARYROLE,ANIMALGUARDTYPE,AUTOIDC,BANKCODE,BUCKETTRUCKIDC, CALTRANSPERMITIDC,CEDSADEVICEID,CEDSADEVICEID_U,CEDSASTRUCTUREID,CEDSATRANSFORMERID, CHANGEDBY,CHANGEDON,CIRCUITID,CIRCUITID2,CITY, CLIMATEZONE,COASTALIDC,COMMENTS,COMPLEXDEVICEIDC,CONVCIRCUITID, CONVCIRCUITID2,CONVERSIONID,CONVERSIONID_U,CONVERSIONWORKPACKAGE,CONVERSIONWORKPACKAGE_U, COUNTY,CUSTAGREEMENTGUID,CUSTOMEROWNED,DISTRIBUTEDGENERATIONIDC,DISTRICT, DIVISION,ELECTRICTRACEWEIGHT,ENABLED,FEEDERINFO,FIELDINVESTIGATIONCODE, FUNCTIONALLOC,GEMSCIRCUITMAPNUM,GEMSDISTMAPNUM,GEMSOTHERMAPNUM,GLOBALID, GLOBALID_U,GROUNDEDIDC,HIGHSIDECONFIGURATION,HIGHSIDEPROTECTION,HIGHSIDEVOLTAGE, INSTALLATIONDATE,INSTALLATIONDATE_U,INSTALLATIONTYPE,INSTALLJOBNUMBER,INSTALLJOBNUMBER_U, INSTALLJOBPREFIX,INSTALLJOBPREFIX_U,INSTALLJOBYEAR,INSTALLJOBYEAR_U,INSTRUCTIONS, INSULATINGFLUIDTYPE,INTERRUPTERIDC,LABELTEXT,LABELTEXT2,LATITUDE, LISTNAME,LISTNAME_U,LIVEFRONTIDC,LOADBREAK,LOCALOFFICEID, LOCALOPOFFICE,LOCDESC,LONGDESC,LONGITUDE,LOWSIDEVOLTAGE, MANUFACTURER,MATERIALCODE,NETWORKGROUPNUMBER,NUMBEROFPHASES,NUMBEROFPHASES_U, OBJECTID,OBJECTID_U,OPERATINGNUMBER,OPERATINGVOLTAGE,PHASEDESIGNATION, PHASEDESIGNATION_U,PHASINGVERIFIEDSTATUS,RATEDKVA,RATEDKVA_U,REGION, REGULATEDOUTPUTIDC,REPLACEGUID,REPLACEGUID_U,RETIREDATE,RETIREDATE_U, SAPEQUIPID,SAPSORTFIELD,SERIALNUMBER,SHAPE,SHORTDESC, SORTINGORDER,SOURCESIDEDEVICEID,SPOTIDC,SPOTWITH,STABILIZINGBANKIDC, STATUS,STATUS_U,STREET,STRUCTURECONVID,SUBMERSIBLEIDC, SUBTYPECD,SUBTYPECD_U,SUBWAYIDC,SUMMERKVA,SUMMERPCT, SUPERORDEQUIP,SUPERVISORYCONTROL,SYMBOLNUMBER,SYMBOLROTATION,SYMBOLSPACE, TECHIDENTNO,TEMPEQUIPID,TRANSFORMERCONVID,TRANSFORMERGUID,TRANSFORMERTYPE, UNITCOUNT,UNITID,VAULT,VAULTLOCATION,VERSIONNAME, WINTERKVA,WINTERPCT,YEARMANUFACTURED,ZHPCTIMP,ZIP, CGC12,"ID_Type","InstalledLightningArrestor","ModelNumber","NetworkGroupName", "PartNumber",POSITIONDESCRIPTION,"SAP Object Type",STRUCTUREGUID,STRUCTURENUMBER, CREATIONUSER,DATECREATED,DATEMODIFIED,LASTUSER,CREATIONUSER_U, DATECREATED_U,DATEMODIFIED_U,LASTUSER_U) TABLESPACE EDGIS PCTUSED 0 PCTFREE 10 INITRANS 2 MAXTRANS 255 STORAGE ( INITIAL 64K NEXT 1M MINEXTENTS 1 MAXEXTENTS UNLIMITED PCTINCREASE 0 BUFFER_POOL DEFAULT ) NOCACHE NOLOGGING NOCOMPRESS BUILD IMMEDIATE REFRESH FORCE ON DEMAND WITH PRIMARY KEY AS 
/* Formatted on 7/2/2019 01:16:38 PM (QP5 v5.313) */
(SELECT a.ANCILLARYROLE,
        a.ANIMALGUARDTYPE,
        a.AUTOIDC,
        b.BANKCODE,
        b.BUCKETTRUCKIDC,
        b.CALTRANSPERMITIDC,
        a.CEDSADEVICEID,
        b.CEDSADEVICEID
            AS "CEDSADEVICEID_U",
        a.CEDSASTRUCTUREID,
        b.CEDSATRANSFORMERID,
        a.CHANGEDBY,
        a.CHANGEDON,
        a.CIRCUITID,
        a.CIRCUITID2,
        a.CITY,
        a.CLIMATEZONE,
        a.COASTALIDC,
        a.COMMENTS,
        a.COMPLEXDEVICEIDC,
        a.CONVCIRCUITID,
        a.CONVCIRCUITID2,
        a.CONVERSIONID,
        b.CONVERSIONID
            AS "CONVERSIONID_U",
        a.CONVERSIONWORKPACKAGE,
        b.CONVERSIONWORKPACKAGE
            AS "CONVERSIONWORKPACKAGE_U",
        a.COUNTY,
        a.CUSTAGREEMENTGUID,
        a.CUSTOMEROWNED,
        a.DISTRIBUTEDGENERATIONIDC,
        a.DISTRICT,
        a.DIVISION,
        a.ELECTRICTRACEWEIGHT,
        a.ENABLED,
        a.FEEDERINFO,
        a.FIELDINVESTIGATIONCODE,
        a.FUNCTIONALLOC,
        a.GEMSCIRCUITMAPNUM,
        a.GEMSDISTMAPNUM,
        a.GEMSOTHERMAPNUM,
        a.GLOBALID,
        b.GLOBALID
            AS "GLOBALID_U",
        a.GROUNDEDIDC,
        a.HIGHSIDECONFIGURATION,
        a.HIGHSIDEPROTECTION,
        a.HIGHSIDEVOLTAGE,
        a.INSTALLATIONDATE,
        b.INSTALLATIONDATE
            AS "INSTALLATIONDATE_U",
        a.INSTALLATIONTYPE,
        a.INSTALLJOBNUMBER,
        b.INSTALLJOBNUMBER
            AS "INSTALLJOBNUMBER_U",
        a.INSTALLJOBPREFIX,
        b.INSTALLJOBPREFIX
            AS "INSTALLJOBPREFIX_U",
        a.INSTALLJOBYEAR,
        b.INSTALLJOBYEAR
            AS "INSTALLJOBYEAR_U",
        a.INSTRUCTIONS,
        a.INSULATINGFLUIDTYPE,
        a.INTERRUPTERIDC,
        a.LABELTEXT,
        a.LABELTEXT2,
        a.LATITUDE,
        a.LISTNAME,
        b.LISTNAME
            AS "LISTNAME_U",
        a.LIVEFRONTIDC,
        a.LOADBREAK,
        a.LOCALOFFICEID,
        a.LOCALOPOFFICE,
        a.LOCDESC,
        b.LONGDESC,
        a.LONGITUDE,
        a.LOWSIDEVOLTAGE,
        b.MANUFACTURER,
        b.MATERIALCODE,
        a.NETWORKGROUPNUMBER,
        a.NUMBEROFPHASES,
        b.NUMBEROFPHASES
            AS "NUMBEROFPHASES_U",
        a.OBJECTID,
        b.OBJECTID
            AS "OBJECTID_U",
        a.OPERATINGNUMBER,
        a.OPERATINGVOLTAGE,
        a.PHASEDESIGNATION,
        b.PHASEDESIGNATION
            AS "PHASEDESIGNATION_U",
        a.PHASINGVERIFIEDSTATUS,
        a.RATEDKVA,
        b.RATEDKVA
            AS "RATEDKVA_U",
        a.REGION,
        a.REGULATEDOUTPUTIDC,
        a.REPLACEGUID,
        b.REPLACEGUID
            AS "REPLACEGUID_U",
        a.RETIREDATE,
        b.RETIREDATE
            AS "RETIREDATE_U",
        b.SAPEQUIPID,
        b.SAPSORTFIELD,
        b.SERIALNUMBER,
        a.SHAPE,
        b.SHORTDESC,
        a.SORTINGORDER,
        a.SOURCESIDEDEVICEID,
        a.SPOTIDC,
        a.SPOTWITH,
        a.STABILIZINGBANKIDC,
        a.STATUS,
        b.STATUS
            AS "STATUS_U",
        a.STREET,
        a.STRUCTURECONVID,
        a.SUBMERSIBLEIDC,
        a.SUBTYPECD,
        b.SUBTYPECD
            AS "SUBTYPECD_U",
        a.SUBWAYIDC,
        a.SUMMERKVA,
        a.SUMMERPCT,
        a.SUPERORDEQUIP,
        b.SUPERVISORYCONTROL,
        a.SYMBOLNUMBER,
        a.SYMBOLROTATION,
        a.SYMBOLSPACE,
        a.TECHIDENTNO,
        b.TEMPEQUIPID,
        b.TRANSFORMERCONVID,
        b.TRANSFORMERGUID,
        b.TRANSFORMERTYPE,
        a.UNITCOUNT,
        b.UNITID,
        a.VAULT,
        a.VAULTLOCATION,
        a.VERSIONNAME,
        a.WINTERKVA,
        a.WINTERPCT,
        b.YEARMANUFACTURED,
        b.ZHPCTIMP,
        a.ZIP,
        a.CGC12,
        CAST (NULL AS VARCHAR2 (50))
            AS "ID_Type",
        CAST (NULL AS VARCHAR2 (50))
            AS "InstalledLightningArrestor",
        CAST (NULL AS VARCHAR2 (50))
            AS "ModelNumber",
        CAST (NULL AS VARCHAR2 (50))
            AS "NetworkGroupName",
        CAST (NULL AS VARCHAR2 (50))
            AS "PartNumber",
        CAST (NULL AS VARCHAR2 (50))
            AS "POSITIONDESCRIPTION",
        (CASE
             WHEN a.subtypecd IN (1,
                                  2,
                                  3,
                                  4,
                                  7,
                                  8)
             THEN
                 'ED.TXFR'
             ELSE
                 (CASE WHEN a.subtypecd IN (5) THEN 'ED.NTTX' ELSE 'NA' END)
         END)
            AS "SAP Object Type",
        a.StructureGUID,
        DECODE (p.globalid, NULL, c.STRUCTURENUMBER, 'X')
            STRUCTURENUMBER,
        NVL (a.CREATIONUSER, a.LASTUSER)
            CREATIONUSER,
        NVL (a.DATECREATED, a.DATEMODIFIED)
            DATECREATED,
        NVL (a.DATEMODIFIED, a.DATECREATED)
            DATEMODIFIED,
        NVL (a.LASTUSER, a.CREATIONUSER)
            LASTUSER,
        NVL (b.CREATIONUSER, b.LASTUSER)
            CREATIONUSER_U,
        NVL (b.DATECREATED, b.DATEMODIFIED)
            DATECREATED_U,
        NVL (b.DATEMODIFIED, b.DATECREATED)
            DATEMODIFIED_U,
        NVL (b.LASTUSER, b.CREATIONUSER)
            LASTUSER_U
   FROM edgis.zz_mv_TRANSFORMER        a,
        edgis.zz_mv_TRANSFORMERUNIT    b,
        EDGIS.STRUCTURES_INTRM_VW      c,
        edgis.zz_mv_devicegroup        g,
        edgis.zz_mv_padmountstructure  p
  WHERE     b.Transformerguid = a.GLOBALID
        AND b.Transformerguid = c.DEVICEGUID(+)
        AND a.subtypecd IN (1,
                            2,
                            3,
                            4,
                            5,
                            7,
                            8)
        AND a.structureguid = g.globalid(+)
        AND g.structureguid = p.globalid(+))
/


COMMENT ON MATERIALIZED VIEW EDGIS.TRANSFORMERUNIT_FVW IS 'snapshot table for snapshot EDGIS.TRANSFORMERUNIT_FVW'
/

Prompt Grants on MATERIALIZED VIEW TRANSFORMERUNIT_FVW TO GIS_SAP_RECON to GIS_SAP_RECON;
GRANT SELECT ON EDGIS.TRANSFORMERUNIT_FVW TO GIS_SAP_RECON
/
